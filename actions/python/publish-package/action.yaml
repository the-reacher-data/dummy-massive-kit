name: "Publish Package"
description: "Build package and publish to PyPI"

inputs:
  pypi-url:
    description: "PyPI URL"
    required: true
  pypi-user-name:
    description: "PyPI user name"
    required: true
  pypi-secret:
    description: "PyPI secret"
    required: tru

runs:
  using: composite
  steps:
    - uses: ./actions/python/uv-requirements
      with:
        requirements: ${{ github.action_path }}/requirements.txt

    - name: Build package
      shell: bash
      run: uv run python -m build

    - name: Check built distributions
      shell: bash
      run: uv run twine check dist/*
    

    - name: Publish to PyPI
      uses: pypa/gh-action-pypi-publish@release/v1
      with:
        repository-url: ${{inputs.pypi-url}}
        user: ${{inputs.pypi-user-name}}
        password: ${{inputs.pypi-secret}}
        docker-image: ghcr.io/pypa/gh-action-pypi-publish:release-v1
        skip-existing: true 
